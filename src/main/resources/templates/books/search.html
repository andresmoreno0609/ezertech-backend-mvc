<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Books - Search</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" th:href="@{/}">Library</a>
        <div class="navbar-nav">
            <a class="nav-link" th:href="@{/books}">Books</a>
            <a class="nav-link" th:href="@{/loans}">Loans</a>
        </div>
    </div>
</nav>

<div class="container py-4">
    <h2>Search Books</h2>

    <form th:action="@{/books/search}" method="get" class="row g-3 mb-4">
        <div class="col-md-10">
            <input type="text" class="form-control" name="query" placeholder="Search by title, author or ISBN" th:value="${query}">
        </div>
        <div class="col-md-2 d-grid">
            <button class="btn btn-primary" type="submit">Search</button>
        </div>
    </form>

    <div th:if="${books != null}">
        <h5 th:text="'Results: ' + ${books.size()}"></h5>

        <table class="table table-striped mt-3" th:if="${!books.isEmpty()}">
            <thead>
            <tr>
                <th>Title</th><th>Author</th><th>ISBN</th><th>Status</th><th>Action</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="book : ${books}">
                <td th:text="${book.title}"></td>
                <td th:text="${book.author}"></td>
                <td th:text="${book.isbn}"></td>
                <td th:text="${book.status}" th:class="'fw-bold ' + (${book.status} == 'AVAILABLE' ? 'text-success' : (${book.status} == 'BORROWED' ? 'text-danger' : 'text-warning'))"></td>
                <td>
                    <a class="btn btn-sm btn-warning" th:if="${book.status == 'AVAILABLE'}" th:href="@{/loans/new(bookId=${book.id})}">Borrow</a>
                </td>
            </tr>
            </tbody>
        </table>

        <div class="alert alert-info mt-3" th:if="${books.isEmpty()}">No books found.</div>
    </div>

    <a class="btn btn-secondary mt-3" th:href="@{/books}">Back to list</a>
</div>

<script src="/js/bootstrap.bundle.min.js"></script>
</body>
</html>
